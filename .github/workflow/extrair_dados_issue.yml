name: Extrair dados de issues

on:
  issues:
    types: [opened, edited]

jobs:
  process-issue:
    runs-on: ubuntu-24.04

    steps:
      # 1Ô∏è‚É£ Baixar o reposit√≥rio
      - name: Checkout
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Configurar Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      # 3Ô∏è‚É£ Salvar a issue atual em issues.json
      - name: Exportar dados da issue para JSON
        run: |
          echo "Exportando dados da issue atual para issues.json"
          echo '[{"title": "${{ github.event.issue.title }}", "body": "${{ github.event.issue.body }}", "labels": ${{ toJson(github.event.issue.labels) }} }]' > issues.json

      # 4Ô∏è‚É£ Mostrar conte√∫do do issues.json (debug)
      - name: Mostrar issues.json
        run: cat issues.json

      # 5Ô∏è‚É£ Rodar script de processamento da issue
      - name: Processar issue
        run: python script/processa_issue.py

      # 6Ô∏è‚É£ Criar branch com n√∫mero da issue
      - name: Criar branch
        run: git checkout -b issue-${{ github.event.issue.number }}

      # 7Ô∏è‚É£ Configurar Git
      - name: Configurar usu√°rio do Git
        run: |
          git config --local user.email "jlprcarvalho@gmail.com"
          git config --local user.name "GitHub Actions"

      # 8Ô∏è‚É£ Commitar altera√ß√µes com closes
      - name: Commitar altera√ß√µes
        run: |
          git add .
          git commit -m "${{ github.event.issue.title }} - ${{ github.event.issue.body }} (closes #${{ github.event.issue.number }})" || echo "Sem altera√ß√µes para commit"

      # 9Ô∏è‚É£ Fazer push para a branch criada
      - name: Fazer push
        run: git push origin HEAD
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # üîü Limpar arquivo tempor√°rio
      - name: Remover issues.json
        run: rm issues.json
